<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>HydroBuddy ‚Äî Daily Water Tracker</title>
  <meta name="description" content="Lightweight hydration tracker with Long Run mode and Race Day planner. Your data stays in your browser."/>
  <style>
    :root{
      --bg:#f6fbff; --fg:#0f172a; --muted:#64748b; --card:#ffffff; --line:#e2e8f0;
      --primary:#0ea5e9; --primary-600:#0284c7; --good:#10b981; --ring:#bae6fd;
      --radius:16px; --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      color:var(--fg); background:linear-gradient(#edfaff, #fff);
    }
    .container{max-width:980px;margin:0 auto;padding:16px 16px 40px}
    header{display:flex;align-items:center;justify-content:space-between;padding:8px 0 12px;flex-wrap:wrap;gap:8px}
    h1{margin:0;font-size:22px;display:flex;gap:8px;align-items:center}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){ .grid{grid-template-columns: 1.6fr 1fr} }
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 6px 20px rgba(2,16,28,.05)}
    .card .p{padding:16px}
    .title{font-weight:600;margin:0 0 4px}
    .desc{margin:0;color:var(--muted);font-size:14px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .btn{border:1px solid var(--line);background:#fff;border-radius:14px;padding:10px 12px;cursor:pointer;
         box-shadow:0 2px 0 rgba(2,16,28,.05);font-weight:600}
    .btn:hover{background:#f8fafc}
    .btn.primary{background:var(--primary);color:#fff;border-color:var(--primary);}
    .btn.primary:hover{background:var(--primary-600)}
    .btn.ghost{background:#fff;border-color:#dbeafe}
    .btn.warn{background:#fff7ed;border-color:#fed7aa;color:#9a3412}
    input[type="number"], input[type="time"], input[type="text"]{
      height:42px;padding:0 12px;border-radius:12px;border:1px solid var(--line);outline:none;
    }
    input:focus, select:focus, textarea:focus{box-shadow:0 0 0 4px var(--ring);border-color:#93c5fd}
    .chip{border:1px solid var(--line);padding:6px 10px;border-radius:999px;font-size:13px}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .progress{width:100%;height:12px;background:#e2e8f0;border-radius:999px;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg, var(--primary), #22d3ee);width:0%}
    .small{font-size:12px;color:var(--muted)}
    .sp{height:8px}
    footer{margin-top:20px;text-align:center;font-size:12px;color:#94a3b8}

    /* celebration */
    .confetti{
      position:relative; background:linear-gradient(90deg,#ecfeff,#ecfdf5); color:#065f46;
      border:1px dashed #99f6e4; border-radius:14px; padding:10px; text-align:center; font-weight:700
    }
    .confetti::after{
      content:""; position:absolute; inset:0; pointer-events:none;
      background:
        radial-gradient(circle,#06b6d4 28%,transparent 29%) 4px 6px/16px 16px,
        radial-gradient(circle,#a7f3d0 28%,transparent 29%) 12px -2px/18px 18px,
        radial-gradient(circle,#60a5fa 28%,transparent 29%) 0 0/14px 14px;
      opacity:.5; animation:pop 1s ease forwards;
    }
    @keyframes pop{from{transform:scale(.98);opacity:0} to{transform:scale(1);opacity:.7}}
    canvas{width:100%;height:180px;border-radius:12px;border:1px solid var(--line);background:#fff}

    /* Long run banner */
    .banner{
      border:1px dashed #a7f3d0;background:linear-gradient(90deg,#ecfdf5,#ecfeff);
      color:#065f46;border-radius:12px;padding:10px;font-weight:600;display:none;margin-top:8px
    }

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(15,23,42,.4);display:none;align-items:center;justify-content:center;padding:16px}
    .modal .panel{max-width:720px;width:100%;background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 18px 40px rgba(2,16,28,.2)}
    .modal .panel .p{padding:16px}
    .modal .panel header{justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--line)}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid #fde68a;background:#fffbeb;color:#92400e;border-radius:999px;padding:6px 10px;font-size:12px}
    .k{display:flex;gap:10px;flex-wrap:wrap}
    .note{font-size:12px;color:#64748b}
    .list{padding-left:18px;margin:8px 0}
    .list li{margin:4px 0}
    label.checkbox{display:flex;align-items:center;gap:8px;user-select:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üíß HydroBuddy</h1>
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <button id="longRunBtn" class="btn warn">Long Run Mode: Off</button>
        <button id="raceBtn" class="btn ghost">Race Day Planner</button>
        <button id="settingsBtn" class="btn ghost">Settings</button>
        <button id="resetBtn" class="btn">Reset Today</button>
      </div>
    </header>

    <!-- Long run banner -->
    <div id="longRunBanner" class="banner">
      Long Run Mode ON ‚Äî goal boosted by <span id="lrBoostText">+1000 ml</span>. During your run: sip 400‚Äì800 ml/h and include 300‚Äì500 mg sodium per hour (tabs/drink). After: replace ~150% of weight lost.
    </div>

    <div class="grid">
      <div class="left">
        <div class="card">
          <div class="p">
            <p class="title">Today's Goal</p>
            <p class="desc">Track your sips and watch the bar fill up.</p>

            <div class="row">
              <div>
                <div class="small">Date</div>
                <div id="todayDate" style="font-weight:600"></div>
              </div>
              <div style="text-align:right">
                <div class="small">Remaining</div>
                <div id="remaining" style="font-weight:600"></div>
              </div>
            </div>

            <div class="sp"></div>
            <div class="progress"><div id="bar" class="bar"></div></div>
            <div class="row small" style="margin-top:6px">
              <span>Progress</span><span id="percent" style="font-weight:700">0%</span>
            </div>

            <div class="sp"></div>
            <div class="row" style="gap:10px;flex-wrap:wrap">
              <button class="btn" data-add="250">+ 250 ml</button>
              <button class="btn" data-add="350">+ 350 ml</button>
              <button class="btn" data-add="500">+ 500 ml</button>
              <button class="btn" data-add="750">+ 750 ml</button>
            </div>

            <div class="sp"></div>
            <div class="row">
              <input id="customMl" type="number" min="0" placeholder="Custom (ml)" style="width:140px"/>
              <button id="addCustom" class="btn primary">Add</button>
            </div>

            <div class="sp"></div>
            <div>
              <div class="small" style="font-weight:600;margin-bottom:6px">Today's entries</div>
              <div id="entries" class="chips"></div>
            </div>

            <div id="celebrate" class="sp confetti" style="display:none">üéâ Goal reached ‚Äî nice work!</div>
          </div>
        </div>
      </div>

      <div class="right">
        <div class="card">
          <div class="p">
            <p class="title">Last 7 days</p>
            <p class="desc">Your consistency at a glance.</p>
            <div class="sp"></div>
            <canvas id="chart" width="600" height="180" aria-label="Last 7 days chart"></canvas>
            <div class="small">Dashed line marks your daily goal.</div>
          </div>
        </div>

        <div class="card">
          <div class="p">
            <p class="title">Streaks & Tips</p>
            <p class="desc">Stay hydrated like a pro runner.</p>
            <div class="sp"></div>
            <div><span class="streak" id="streak" style="font-weight:700">0</span> day streak</div>
            <ul class="small">
              <li>Sip regularly ‚Äî ~200 ml each awake hour.</li>
              <li>Before runs: 500‚Äì700 ml 2‚Äì3 h prior; 200‚Äì300 ml 30 min prior.</li>
              <li>Long runs: 400‚Äì800 ml/h + 300‚Äì500 mg sodium/h.</li>
              <li>After sweaty sessions: replace ~150% of weight lost.</li>
            </ul>
          </div>
        </div>

        <div class="card" id="settings" style="display:none">
          <div class="p">
            <p class="title">Settings</p>
            <div class="sp"></div>
            <div class="row">
              <label class="small" for="goal">Daily goal (ml)</label>
              <input id="goal" type="number" min="500" step="50" style="width:120px"/>
            </div>
            <div class="sp"></div>
            <div class="row">
              <label class="small" for="unitLiters">Show liters</label>
              <input id="unitLiters" type="checkbox"/>
            </div>
            <div class="sp"></div>
            <div class="row">
              <label class="small" for="longRunExtra">Long Run boost (ml)</label>
              <input id="longRunExtra" type="number" min="0" step="100" style="width:120px"/>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>Built with üíß by HydroBuddy. Your data stays in your browser.</footer>
  </div>

  <!-- Race Day Modal -->
  <div id="raceModal" class="modal" aria-hidden="true">
    <div class="panel">
      <header>
        <h3 style="margin:0;font-size:18px">üèÅ Race Day Planner</h3>
        <button id="closeRace" class="btn">Close</button>
      </header>
      <div class="p">
        <p class="desc">Enter your start time and expected duration. We‚Äôll generate a simple, time-stamped hydration & electrolyte plan.</p>
        <div class="sp"></div>
        <div class="k">
          <div>
            <div class="small">Race start (local time)</div>
            <input id="raceStart" type="time"/>
          </div>
          <div>
            <div class="small">Expected duration (min)</div>
            <input id="raceDur" type="number" min="30" step="10" value="120" style="width:140px"/>
          </div>
          <label class="checkbox">
            <input id="raceHot" type="checkbox"/> Hot/humid day
          </label>
          <label class="checkbox">
            <input id="raceSalty" type="checkbox"/> I‚Äôm a heavy/salty sweater
          </label>
          <button id="genPlan" class="btn primary">Generate plan</button>
        </div>
        <div class="sp"></div>
        <div id="racePlan" class="card" style="display:none">
          <div class="p">
            <div class="pill">Guideline: 150‚Äì250 ml every ~20 min ¬∑ Electrolytes: <span id="sodiumRange">300‚Äì500</span> mg sodium/h</div>
            <ul id="raceList" class="list"></ul>
            <div class="note">Tip: weigh before/after. Replace ~150% of fluid lost over 4‚Äì6 h post-race.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const ML_DEFAULT = 3500;
  const STORAGE_KEY = "hydrobuddy_static_v2";
  const todayKey = () => {
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  };
  const $ = (id)=>document.getElementById(id);
  const saved = JSON.parse(localStorage.getItem(STORAGE_KEY)||"{}");

  let goal = typeof saved.goal==="number" ? saved.goal : ML_DEFAULT;
  let unitLiters = !!saved.unitLiters;
  let history = saved.history || {};
  let longRunMode = !!saved.longRunMode;
  let longRunExtra = typeof saved.longRunExtra==="number" ? saved.longRunExtra : 1000;

  let today = todayKey();
  if(!history[today]) history[today] = { total:0, goal:getTodayGoal(), entries:[] };

  const els = {
    date: $("todayDate"),
    remaining: $("remaining"),
    bar: $("bar"),
    percent: $("percent"),
    entries: $("entries"),
    chart: $("chart"),
    streak: $("streak"),
    goal: $("goal"),
    unit: $("unitLiters"),
    settings: $("settings"),
    settingsBtn: $("settingsBtn"),
    resetBtn: $("resetBtn"),
    addCustom: $("addCustom"),
    customMl: $("customMl"),
    celebrate: $("celebrate"),
    longRunBtn: $("longRunBtn"),
    longRunBanner: $("longRunBanner"),
    lrBoostText: $("lrBoostText"),
    longRunExtra: $("longRunExtra"),
    raceBtn: $("raceBtn"),
    raceModal: $("raceModal"),
    closeRace: $("closeRace"),
    raceStart: $("raceStart"),
    raceDur: $("raceDur"),
    raceHot: $("raceHot"),
    raceSalty: $("raceSalty"),
    genPlan: $("genPlan"),
    racePlan: $("racePlan"),
    raceList: $("raceList"),
    sodiumRange: $("sodiumRange"),
  };

  function mlToL(ml){ return (ml/1000).toFixed(2)+" L"; }
  function fmt(ml){ return unitLiters ? mlToL(ml) : (ml+" ml"); }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify({goal, unitLiters, history, longRunMode, longRunExtra})); }
  function time(ts){ return new Date(ts).toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"}); }
  function ensureToday(){
    const k = todayKey();
    if(k!==today){ today = k; if(!history[today]) history[today] = { total:0, goal:getTodayGoal(), entries:[] }; }
  }
  function getTodayGoal(){ return goal + (longRunMode ? longRunExtra : 0); }

  function render(){
    ensureToday();
    els.longRunExtra.value = longRunExtra;
    els.lrBoostText.textContent = `+${longRunExtra} ml`;
    els.longRunBtn.textContent = `Long Run Mode: ${longRunMode ? "On" : "Off"}`;
    els.longRunBtn.className = "btn " + (longRunMode ? "warn" : "warn");
    els.longRunBanner.style.display = longRunMode ? "block" : "none";

    const day = history[today];
    day.goal = getTodayGoal();

    els.date.textContent = today;
    const remaining = Math.max(0,(day.goal) - day.total);
    els.remaining.textContent = fmt(remaining);
    const pct = Math.min(100, Math.round( (day.total / day.goal)*100 ));
    els.bar.style.width = pct + "%";
    els.percent.textContent = pct + "%";

    els.entries.innerHTML = "";
    for(const e of (day.entries||[])){
      const span=document.createElement("span");
      span.className="chip";
      span.textContent = fmt(e.ml) + " ‚Ä¢ " + time(e.ts);
      els.entries.appendChild(span);
    }
    els.celebrate.style.display = (day.total >= day.goal) ? "block":"none";

    const last7 = [];
    for(let i=6;i>=0;i--){
      const d = new Date(); d.setDate(d.getDate()-i);
      const k = d.toISOString().slice(0,10);
      const rec = history[k];
      last7.push({label: k.slice(5), total: rec?rec.total:0, goal: (rec?rec.goal:getTodayGoal())});
    }
    drawChart(els.chart, last7, getTodayGoal());
    els.streak.textContent = calcStreak();

    els.goal.value = goal;
    els.unit.checked = unitLiters;
  }

  function addWater(ml){
    ensureToday();
    const day = history[today];
    day.total += ml;
    (day.entries ||= []).push({ ml, ts:Date.now() });
    save(); render();
  }
  function resetToday(){
    history[today] = { total:0, goal:getTodayGoal(), entries:[] };
    save(); render();
  }
  function calcStreak(){
    let s=0;
    for(let i=0;i<30;i++){
      const d = new Date(); d.setDate(d.getDate()-i);
      const k = d.toISOString().slice(0,10);
      const rec = history[k];
      const g = (rec && rec.goal) ? rec.goal : goal;
      if(rec && rec.total >= g) s++; else break;
    }
    return s;
  }

  function drawChart(canvas, data, goalLine){
    const ctx = canvas.getContext("2d");
    const W = canvas.width, H = canvas.height;
    ctx.clearRect(0,0,W,H);
    ctx.strokeStyle = "#e2e8f0"; ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(30,10); ctx.lineTo(30,H-20); ctx.lineTo(W-10,H-20); ctx.stroke();

    const maxVal = Math.max(goalLine, ...data.map(d=>d.total), 1000);
    const chartW = W-50, chartH = H-40;
    const barW = chartW / data.length - 10;

    const gy = H-20 - (goalLine/maxVal)*chartH;
    ctx.setLineDash([5,5]); ctx.strokeStyle="#94a3b8";
    ctx.beginPath(); ctx.moveTo(30,gy); ctx.lineTo(W-10,gy); ctx.stroke();
    ctx.setLineDash([]);

    data.forEach((d, i)=>{
      const x = 40 + i*(barW+10);
      const h = (d.total/maxVal)*chartH;
      const y = H-20 - h;
      const grd = ctx.createLinearGradient(0,y,0,H);
      grd.addColorStop(0,"#0ea5e9"); grd.addColorStop(1,"#22d3ee");
      ctx.fillStyle = grd;
      const r = 6; const w = barW;
      ctx.beginPath();
      ctx.moveTo(x, y+r);
      ctx.arcTo(x, y, x+r, y, r);
      ctx.lineTo(x+w-r, y);
      ctx.arcTo(x+w, y, x+w, y+r, r);
      ctx.lineTo(x+w, H-20);
      ctx.lineTo(x, H-20);
      ctx.closePath();
      ctx.fill();

      ctx.fillStyle="#475569"; ctx.font="12px system-ui";
      ctx.textAlign="center";
      ctx.fillText(d.label, x+w/2, H-6);
    });
  }

  // Wire up UI
  document.querySelectorAll("[data-add]").forEach(btn=>{
    btn.addEventListener("click", ()=> addWater(parseInt(btn.getAttribute("data-add"),10)||0));
  });
  $("addCustom").addEventListener("click", ()=>{
    const amt = parseInt($("customMl").value,10)||0;
    if(amt>0) addWater(amt);
  });
  els.resetBtn.addEventListener("click", resetToday);
  els.settingsBtn.addEventListener("click", ()=>{
    els.settings.style.display = (els.settings.style.display==="none")?"block":"none";
  });
  els.goal.addEventListener("change", ()=>{
    goal = parseInt(els.goal.value,10)||ML_DEFAULT;
    if(history[today]) history[today].goal = getTodayGoal();
    save(); render();
  });
  els.unit.addEventListener("change", ()=>{ unitLiters = !!els.unit.checked; save(); render(); });
  els.longRunExtra.addEventListener("change", ()=>{
    longRunExtra = Math.max(0, parseInt(els.longRunExtra.value,10)||1000);
    save(); render();
  });

  els.longRunBtn.addEventListener("click", ()=>{
    longRunMode = !longRunMode;
    if(history[today]) history[today].goal = getTodayGoal();
    save(); render();
  });

  // Race modal logic
  const openModal = ()=>{ els.raceModal.style.display="flex"; };
  const closeModal = ()=>{ els.raceModal.style.display="none"; };
  els.raceBtn.addEventListener("click", openModal);
  els.closeRace.addEventListener("click", closeModal);
  els.raceModal.addEventListener("click", (e)=>{ if(e.target===els.raceModal) closeModal(); });

  els.genPlan.addEventListener("click", ()=>{
    const t = els.raceStart.value; // "HH:MM"
    const durMin = Math.max(30, parseInt(els.raceDur.value,10)||120);
    if(!t){ alert("Pick a start time"); return; }
    const [hh,mm] = t.split(":").map(Number);
    const raceDate = new Date(); raceDate.setHours(hh,mm,0,0);

    // sodium guidance
    const highSodium = (els.raceHot.checked || els.raceSalty.checked);
    els.sodiumRange.textContent = highSodium ? "400‚Äì700" : "300‚Äì500";

    const items = [];
    // Pre
    items.push({when: new Date(raceDate.getTime()-3*60*60*1000), text:"Drink 500‚Äì700 ml water/electrolyte"});
    items.push({when: new Date(raceDate.getTime()-30*60*1000), text:"Sip 200‚Äì300 ml water"});

    // During (every 20 min water cue + hourly electrolyte cue)
    const startMs = raceDate.getTime(), endMs = startMs + durMin*60*1000;
    for(let ms=startMs; ms<endMs; ms += 20*60*1000){
      items.push({when:new Date(ms), text:"Sip ~150‚Äì250 ml"});
    }
    for(let ms=startMs+60*60*1000; ms<=endMs; ms += 60*60*1000){
      items.push({when:new Date(ms), text:`Electrolytes ${highSodium?"400‚Äì700":"300‚Äì500"} mg sodium`});
    }

    // Post
    items.push({when: new Date(endMs+10*60*1000), text:"Rehydrate steadily; target ~150% of weight lost over 4‚Äì6 h"});

    // Render list
    items.sort((a,b)=>a.when-b.when);
    els.raceList.innerHTML = "";
    for(const it of items){
      const li = document.createElement("li");
      li.textContent = it.when.toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"}) + " ‚Äî " + it.text;
      els.raceList.appendChild(li);
    }
    els.racePlan.style.display = "block";
  });

  // initial render + rollover watcher
  render();
  setInterval(()=>{ render(); }, 30000);
})();
</script>
</body>
</html>
